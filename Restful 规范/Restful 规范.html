<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>Restful 规范 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Restful 规范" class="main-title"></div></div></header><article><h3 class="wolai-block"><span class="inline-wrap">发展背景</span></h3><div class="wolai-block wolai-text"><div><span class="inline-wrap">网络应用程序，分为前端和后端两个部分。当前的发展趋势，就是前端设备层出不穷（手机、平板、桌面电脑、其他专用设备…）。因此，必须有一种统一的机制，方便不同的前端设备与后端进行通信。这导致<span class="jill"></span>API<span class="jill"></span>构架的流行，甚至出现&quot;APIFirst&quot;的设计思想。RESTful API<span class="jill"></span>是目前比较成熟的一套互联网应用程序的<span class="jill"></span>API<span class="jill"></span>设计理论。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">REST（Representational State Transfer）表述性状态转换，REST<span class="jill"></span>指的是一组架构约束条件和原则。 如果一个架构符合<span class="jill"></span>REST<span class="jill"></span>的约束条件和原则，我们就称它为<span class="jill"></span>RESTful<span class="jill"></span>架构。REST<span class="jill"></span>本身并没有创造新的技术、组件或服务，而隐藏在<span class="jill"></span>RESTful<span class="jill"></span>背后的理念就是使用<span class="jill"></span>Web<span class="jill"></span>的现有特征和能力， 更好地使用现有<span class="jill"></span>Web<span class="jill"></span>标准中的一些准则和约束。虽然<span class="jill"></span>REST<span class="jill"></span>本身受<span class="jill"></span>Web<span class="jill"></span>技术的影响很深， 但是理论上<span class="jill"></span>REST<span class="jill"></span>架构风格并不是绑定在<span class="jill"></span>HTTP<span class="jill"></span>上，只不过目前<span class="jill"></span>HTTP<span class="jill"></span>是唯一与<span class="jill"></span>REST<span class="jill"></span>相关的实例</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>关键</b></span><span class="inline-wrap">: 是面对现有的网络应用程序的交互方式,设计出来的一种规范,帮助我们更好的管理交互连接.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">达到,见名知义,快速定义的问题.</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h3 class="wolai-block"><span class="inline-wrap">应用</span></h3><h4 class="wolai-block"><span class="inline-wrap">URI<span class="jill"></span>规范</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap">get put post delete</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h4 class="wolai-block"><span class="inline-wrap">安全性和幂等性</span></h4><div class="wolai-block wolai-center"><figure><img src="media/image.png" style="width: 690px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><h4 class="wolai-block"><span class="inline-wrap">0-1</span></h4><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>1.涉及的链路</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">前端<span class="jill"></span>http<span class="jill"></span>请求调用→后端接收</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">2.</span><span class="inline-wrap"><b>涉及的资源</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">前端,各种请求方式的请求头,体. 如,ContentType<span class="jill"></span>这些</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">后端,返回前台的格式,返回体是什么样的,返回码有什么要求,涉及什么规范</span></div></div><div class="wolai-block wolai-center"><figure><img src="media/image_1.png" style="width: 690px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">3.</span><span class="inline-wrap"><b>实践过程中可能出现的问题</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>对错误的处理</b></span></div></div><ol class="wolai-block"><li><div class="marker"></div><span class="inline-wrap">不要发生了错误但给<span class="jill"></span>2xx<span class="jill"></span>响应，客户端可能会缓存成功的<span class="jill"></span>http<span class="jill"></span>请求；</span></li><li><div class="marker"></div><span class="inline-wrap">正确设置<span class="jill"></span>http<span class="jill"></span>状态码，不要自定义；</span></li><li><div class="marker"></div><span class="inline-wrap">Response body 提供 1) 错误的代码（日志/问题追查）；2) 错误的描述文本（展示给用户）。</span></li></ol><div class="wolai-block wolai-text"><div><span class="inline-wrap">对第三点的实现稍微多说一点：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">Java 服务器端一般用异常表示 RESTful API 的错误。API 可能抛出两类异常：业务异常和非业务异常。业务异常由自己的业务代码抛出，表示一个用例的前置条件不满足、业务规则冲突等，比如参数校验不通过、权限校验失败。非业务类异常表示不在预期内的问题，通常由类库、框架抛出，或由于自己的代码逻辑错误导致，比如数据库连接失败、空指针异常、除<span class="jill"></span>0<span class="jill"></span>错误等等。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">业务类异常必须提供<span class="jill"></span>2<span class="jill"></span>种信息：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">如果抛出该类异常，HTTP 响应状态码应该设成什么；
异常的文本描述；
在<span class="jill"></span>Controller<span class="jill"></span>层使用统一的异常拦截器：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">设置 HTTP 响应状态码：对业务类异常，用它指定的 HTTP code；对非业务类异常，统一<span class="jill"></span>500；
Response Body 的错误码：异常类名
Response Body 的错误描述：对业务类异常，用它指定的错误文本；对非业务类异常，线上可以统一文案如“服务器端错误，请稍后再试”，开发或测试环境中用异常的 stacktrace，服务器端提供该行为的开关。</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-center"><figure><img src="media/image_2.png" style="width: 690px"/></figure></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap"><b>api<span class="jill"></span>的演进</b></span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">常见的三种方式：</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">1.在<span class="jill"></span>uri<span class="jill"></span>中放版本信息：GET /v1/users/1  
2.Accept Header：Accept: application/json+v1  
3.自定义 Header：X-Api-Version: 1</span></div></div><div class="wolai-block wolai-text"><div><span class="inline-wrap">URI<span class="jill"></span>失效  
随着系统发展，总有一些<span class="jill"></span>API<span class="jill"></span>失效或者迁移，对失效的<span class="jill"></span>API，返回<span class="jill"></span>404 not found 或 410 gone；对迁移的<span class="jill"></span>API，返回 301 重定向。</span></div></div></article><footer></footer></body></html>